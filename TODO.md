# TODO - Task Backlog

> **Task truth source:** TODO.md
> **Last updated:** 2026-01-05
> **Generated by:** CODE_AUDIT Phase 1-6 execution

---

## P0 - Critical (Correctness, Security, Blockers)

### T-029: Complete Manual Smoke Tests in Preview Deployment [P0] [QUALITY]
**Type:** QUALITY  
**Priority:** P0  
**Category:** REL (Release Gate)  
**Effort:** S

**Context:**  
Release 2026.01.05 smoke tests could not fully complete in the local environment due to Playwright/browser instability and font fetch errors. Manual smoke verification is required in a stable Preview Deployment or live environment.

**Acceptance Criteria:**
- [ ] Verify Universal UI tests in Preview Deployment (app loads, nav works, happy path completes, error state triggers, mobile layout usable)
- [ ] Verify contact form validation errors surface correctly when submitting invalid inputs
- [ ] Record results in the next Release Record

**References:**
- Doc: `RELEASE_CHECKLIST.md`

**Dependencies:** None

---

## P1 - High (Reliability, Core UX, Maintainability)

### T-024: Add IP-Aware Rate Limiting for Contact Form [P1] [SEC]
**Type:** ENHANCE  
**Priority:** P1  
**Category:** SEC (Abuse Prevention)  
**Effort:** M

**Context:**  
Rate limiting currently keys solely on the submitted email address. Attackers can rotate throwaway email values to bypass limits and flood the contact form, causing alert fatigue and potential Resend cost increases. Upstash-backed distributed limiting and the in-memory fallback both need client IP awareness to meaningfully throttle abusive traffic across instances.

**Acceptance Criteria:**
- [ ] Add IP-based throttling for contact form submissions (hash IPs for privacy) and combine with existing per-email limits
- [ ] Extract client IP using trusted headers (`x-forwarded-for`/`x-real-ip`) with sane fallbacks when running on Vercel or similar proxies
- [ ] Apply IP-aware keys to both Upstash rate limiter and in-memory fallback; document window/thresholds alongside privacy considerations
- [ ] Update SECURITY.md or DECISIONS.md to record the rate limiting strategy and IP handling trade-offs
- [ ] Add tests (unit or integration) covering enforcement when only IP changes vs when both email and IP change

**References:**
- File: `lib/actions.ts`
- Doc: `SECURITY.md`
- Doc: `DECISIONS.md`

**Dependencies:** None

---

## P2 - Medium (Hardening, Polish, Documentation)

### T-017: Increase Test Coverage [P2] [QUALITY]
**Type:** ENHANCE  
**Priority:** P2  
**Category:** DX (Developer Experience)  
**Effort:** L

**Context:**  
Current test coverage is low. Need to add tests for core functionality to ensure reliability and enable confident refactoring.

**Acceptance Criteria:**
- [ ] Add tests for `lib/blog.ts`
- [ ] Add tests for `lib/case-studies.ts`
- [ ] Add tests for all UI components in `components/ui/`
- [ ] Add tests for page components
- [ ] Target: 70%+ coverage
- [ ] Run coverage report: `npm run test:coverage`

**References:**
- Doc: `docs/workflows/USERTODO.md` (Item #9)
- Dir: `__tests__/`
- Dir: `tests/`

**Dependencies:** None

---

### T-018: Add E2E Tests for Critical Flows [P2] [QUALITY]
**Type:** ENHANCE  
**Priority:** P2  
**Category:** REL (Reliability)  
**Effort:** M

**Context:**  
No E2E tests exist for critical user journeys. Adding E2E tests will catch integration issues and prevent regressions in key flows.

**Acceptance Criteria:**
- [ ] Homepage → Services → Contact form submission flow
- [ ] Blog listing → Blog post → CTA click flow
- [ ] Mobile navigation flow
- [ ] Contact form validation and submission
- [ ] 404 page handling
- [ ] Run tests: `npm run test:e2e`

**References:**
- Doc: `docs/workflows/USERTODO.md` (Item #10)
- Dir: `tests/e2e/`
- Config: `playwright.config.ts`

**Dependencies:** None

---

### T-019: Optimize Bundle Size [P2] [ENHANCE]
**Type:** ENHANCE  
**Priority:** P2  
**Category:** PERF (Performance)  
**Effort:** M

**Context:**  
Current build output is ~276MB. Need to analyze and optimize bundle size to improve load times and reduce bandwidth usage.

**Acceptance Criteria:**
- [ ] Run bundle analyzer: `ANALYZE=true npm run build`
- [ ] Check for duplicate dependencies
- [ ] Lazy load heavy components (MDX processing)
- [ ] Use dynamic imports for below-fold content
- [ ] Review Sentry bundle size
- [ ] Consider removing unused dependencies
- [ ] Document optimization results

**References:**
- Doc: `docs/workflows/USERTODO.md` (Item #11)
- File: `next.config.mjs`

**Dependencies:** None

---

### T-021: Accessibility Audit [P2] [ENHANCE]
**Type:** ENHANCE  
**Priority:** P2  
**Category:** UX (User Experience)  
**Effort:** M

**Context:**  
No comprehensive accessibility audit has been performed. Need to ensure WCAG 2.1 AA compliance for inclusive user experience.

**Acceptance Criteria:**
- [ ] Use axe DevTools browser extension for automated checks
- [ ] Test with screen reader (VoiceOver/NVDA)
- [ ] Check keyboard navigation
- [ ] Verify color contrast ratios
- [ ] Test focus management
- [ ] Document findings and fixes
- [ ] Target: WCAG 2.1 AA compliance

**References:**
- Doc: `docs/workflows/USERTODO.md` (Item #12)

**Dependencies:** None

---

### T-023: Add Search Functionality [P2] [ENHANCE]
**Type:** ENHANCE  
**Priority:** P2  
**Category:** UX (User Experience)  
**Effort:** M

**Context:**  
No search functionality exists for blog posts or site content. Adding search improves content discoverability and user experience.

**Acceptance Criteria:**
- [ ] Choose search solution (Algolia DocSearch, Pagefind, or custom)
- [ ] Implement search UI component
- [ ] Index blog posts and key pages
- [ ] Add search keyboard shortcut (Cmd/Ctrl + K)
- [ ] Test search relevance and performance
- [ ] Document search configuration

**References:**
- Doc: `docs/workflows/USERTODO.md` (Item #17)

**Dependencies:** None

---

### T-025: Align @next/mdx Version With Next.js [P2] [QUALITY]
**Type:** QUALITY  
**Priority:** P2  
**Category:** DEP (Dependency Health)  
**Effort:** S

**Context:**  
The repo uses next@14.2.18 with @next/mdx@^16.1.1. The major version gap may indicate incompatibility with the current Next.js line, risking MDX build issues.

**Acceptance Criteria:**
- [ ] Confirm the compatible @next/mdx major version for next@14.2.18
- [ ] Update package.json to the compatible @next/mdx version
- [ ] Update lockfiles accordingly
- [ ] Run a build or MDX-related check to confirm no regressions
- [ ] Document the decision in DEPENDENCY_HEALTH.md if any trade-offs exist

**References:**
- File: `package.json`
- File: `next.config.mjs`
- Doc: `DEPENDENCY_HEALTH.md`

**Dependencies:** None

---

### T-026: Move @types/mdx to devDependencies [P2] [QUALITY]
**Type:** QUALITY  
**Priority:** P2  
**Category:** DEP (Dependency Health)  
**Effort:** S

**Context:**  
@types/mdx is listed under production dependencies even though it is only needed for TypeScript types. Keeping it in production dependencies increases install surface area without runtime value.

**Acceptance Criteria:**
- [ ] Move @types/mdx from dependencies to devDependencies
- [ ] Update lockfiles to reflect the change
- [ ] Confirm type-checking still passes (`npm run type-check`)

**References:**
- File: `package.json`

**Dependencies:** None

---

### T-027: Consolidate to a Single Package Manager Lockfile [P2] [QUALITY]
**Type:** QUALITY  
**Priority:** P2  
**Category:** DEP (Dependency Health)  
**Effort:** S

**Context:**  
Both package-lock.json and pnpm-lock.yaml are present. This can lead to drift and inconsistent dependency resolution.

**Acceptance Criteria:**
- [ ] Decide on the canonical package manager (npm or pnpm)
- [ ] Remove the unused lockfile
- [ ] Update documentation (READMEAI.md or DEPLOYMENT.md) to reflect the chosen tool
- [ ] Reinstall dependencies to regenerate the chosen lockfile if needed

**References:**
- File: `package-lock.json`
- File: `pnpm-lock.yaml`
- Doc: `READMEAI.md`

**Dependencies:** None

---

### T-028: Remove Invalid next.config.mjs Keys [P2] [QUALITY]
**Type:** QUALITY  
**Priority:** P2  
**Category:** REL (Reliability)  
**Effort:** S

**Context:**  
Running Next.js dev server reports unrecognized `api` and `sentry` keys in next.config.mjs. These options are no longer supported and may indicate configuration drift or misplaced settings.

**Acceptance Criteria:**
- [ ] Identify the supported replacement for any needed settings (e.g., move to `sentry.server.config.ts` or middleware)
- [ ] Remove unsupported keys from next.config.mjs
- [ ] Confirm `next dev` starts without invalid config warnings
- [ ] Document any configuration changes in DEPENDENCY_HEALTH.md or DECISIONS.md if behavior changes

**References:**
- File: `next.config.mjs`

**Dependencies:** None

---

## Notes

### Task Hygiene Completed
✅ Phase 1 completed on 2026-01-03:
- Moved completed tasks to TODO_COMPLETED.md
- Swept docs for actionable items (USERTODO.md consolidated here)
- Swept code for TODO/FIXME (none found)
- Checked env.example for unused vars (all used)
- Normalized task format to CODE_AUDIT standard
- Prioritized as P0/P1/P2

### Code Quality Issues Found
- TypeScript error in lib/actions.ts (Zod v4 API)
- ESLint warnings in lib/analytics.ts (unused params)
- npm audit vulnerabilities in glob dependency

### Dead Code Candidates
- next-pwa package (deprecated, may not be needed)

### Enhancements from USERTODO.md
- Items #4-23 from USERTODO.md consolidated into this backlog
- All items follow standard format with acceptance criteria

### Priority Definitions
- **P0 (Critical):** Build failures, type errors, security vulnerabilities requiring immediate fix
- **P1 (High):** Production readiness, core security, maintainability that prevents bugs
- **P2 (Medium):** Hardening, polish, documentation, enhancements

### Type Definitions
- **HYGIENE:** Task consolidation and cleanup
- **COMPLETE:** Required functionality that is missing
- **ENHANCE:** Improvement to existing functionality
- **QUALITY:** Code quality, refactoring, or cleanup
- **DEADCODE:** Safe removal of unused code

### Category Codes
- **SEC:** Security-related task
- **DEP:** Dependency health
- **REL:** Reliability
- **PERF:** Performance
- **UX:** User experience
- **DX:** Developer experience

---

*Generated by CODE_AUDIT execution on 2026-01-03*
